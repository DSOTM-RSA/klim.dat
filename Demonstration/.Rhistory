setwd("~/Documents/GitArchive/klim.dat/Demonstration/downloads/product")
library(dplyr)
library(tidyr)
files <- dir(pattern = '*.txt', full.names = TRUE)
pro.df <- files %>%  lapply(., read.table,sep=";",header=TRUE,fill=TRUE) %>%
lapply(., function(x) x[complete.cases(x),]) %>%  lapply(.,"[",1:6) %>% dplyr::bind_rows(.) %>%
.[complete.cases(.),] %>% setNames(c('station.id','date.start','date.end','quality','type','precip'))
date.str <- as.character(pro.df$date.start)
date.beg <-as.character(pro.df$date.start) %>% as.Date(., format='%Y%m%d')
diff_in_days = difftime(date.beg, date.beg[1], units = "days")
diff_in_years = as.double(diff_in_days)/365 # absolute years
abs.years<-floor(diff_in_years)
months_diff = as.double(substring(date.str, 5, 6)) - as.double(substring(date.str[1], 5, 6))
total_months = floor(diff_in_years)*12 + months_diff
frame <- mutate(pro.df,frameID = total_months) %>% .[-114369,] # trim to remove erroneous last obs
frame$station.id <- as.factor(frame$station.id)
frame$station.id <- as.numeric(frame$station.id)
frame$precip[frame$precip==-999] <- NA
frame$precip[frame$precip<=0] <- NA
setwd("~/Documents/GitArchive/klim.dat")
stat.meta<-read.table("stat.csv",header=TRUE, sep =",")
setwd("~/Documents/GitArchive/klim.dat/Demonstration")
stat.meta<-read.table("stat.csv",header=TRUE, sep =",")
stat.meta$station.id <-stat.meta$stat_id %>% as.numeric(.)
library(data.table)
dat.var = as.data.table(frame)
dat.meta = as.data.table(stat.meta)
merged.df<-merge(dat.var,dat.meta, by="station.id")
summary(merged.df)
merged.df$precip[is.na(merged.df$precip)] <- 0
out <- split(merged.df,as.factor(merged.df$frameID)) # get into a list : apply interp to this...
library(akima)
install.packages("akima")
library(akima)
df <- merged.df %>% filter(.,frameID==2000)
fld <- with(df, interp(x = lon, y = lat, z = precip))
filled.contour(x = fld$x,
y = fld$y,
z = fld$z,
color.palette =
colorRampPalette(c("white", "blue")),
xlab = "Longitude",
ylab = "Latitude",
main = "Germany Rainfall September 2010",
key.title = title(main = "Rain (mm)", cex.main = 1))
df.sta <- merged.df %>% filter(.,frameID==600)
sta<-with(df.sta, interp(x = lon, y = lat, z = precip))
filled.contour(x = sta$x,
y = sta$y,
z = sta$z,
color.palette =
colorRampPalette(c("white", "blue")),
xlab = "Longitude",
ylab = "Latitude",
main = "Germany Rainfall January 1894",
key.title = title(main = "Rain (mm)", cex.main = 1))
fld <- with(out$`600`), interp(x = lon, y = lat, z = precip))
fld <- with(out$`600`, interp(x = lon, y = lat, z = precip))
lapply(out,interp(x = lon, y = lat, z = precip)))
lapply(out,interp(x = lon, y = lat, z = precip))
lapply(out$`0`,interp(x = lon, y = lat, z = precip))
lapply(with(out),interp(x = lon, y = lat, z = precip))
sub.df <- merged.df %>% filter(.,frameID>=600)
st <- unique(sub.df$frameID)
mylist <- list()
i=st[1]
for (i in i:st){
mylist[i]<-with(out$`i`), interp(x = lon, y = lat, z = precip))
}
for (i in i:st){
mylist[i]<-with(out$`i`, interp(x = lon, y = lat, z = precip))
}
sub.list <- split(sub.df,sub.df$frameID)
fld <- with(sub.list$`600`), interp(x = lon, y = lat, z = precip))
fld <- with(sub.list$`600`, interp(x = lon, y = lat, z = precip))
mylist <- list()
i=st[1]
for (i in i:st){
mylist[[i]]<-with(sub.list$`i`, interp(x = lon, y = lat, z = precip))
}
st <- unique(sub.df$frameID)
mylist <- list()
i=st[1]
for (i in 600:st){
mylist[[i]]<-with(sub.list$`i`, interp(x = lon, y = lat, z = precip))
}
i=st[1]
for (i in st){
mylist[[i]]<-with(sub.list$`i`, interp(x = lon, y = lat, z = precip))
}
for (i in seq_along(st)){
mylist[[i]]<-with(sub.list$`i`, interp(x = lon, y = lat, z = precip))
}
for (i in seq_along(st)){
mylist[i]<-with(sub.list$`i`, interp(x = lon, y = lat, z = precip))
}
fld <- with(sub.list$`600`, interp(x = lon, y = lat, z = precip))
fld <- with(sub.list$`i`, interp(x = lon, y = lat, z = precip))
fld <- with(sub.list$i, interp(x = lon, y = lat, z = precip))
fld <- with(sub.list$`i`, interp(x = lon, y = lat, z = precip))
fld <- with(sub.list$`i`, interp(x = lon, y = lat, z = precip))
fld <- with(sub.list$`890`, interp(x = lon, y = lat, z = precip))
str(sub.list)
head(str(sub.list))
dput(sub.list)
dput(sub.df)
str(sub.df)
lapply(X = sub.list,FUN = interp)
lapply(X = sub.list,FUN = interp,x=lon,y=lat,z=precip)
lapply(X = sub.list$`600`,FUN = interp,x=lon,y=lat,z=precip)
lapply(X = sub.list$``,FUN = interp,x=lon,y=lat,z=precip)
lapply(X = sub.list,FUN = interp,x=lon,y=lat,z=precip)
sub.list[[]]
sub.list[1]
lapply(X = sub.list[],FUN = interp,x=lon,y=lat,z=precip)
lapply(X = sub.list[1],FUN = interp,x=lon,y=lat,z=precip)
lapply(X = sub.list[[]],FUN = interp,x=lon,y=lat,z=precip)
lapply(X = sub.list``,FUN = interp,x=lon,y=lat,z=precip)
lapply(X = sub.list`x`,FUN = interp,x=lon,y=lat,z=precip)
lapply(X = sub.list`x`,FUN = interp,x=lon,y=lat,z=precip)
lapply(X = sub.list,FUN = interp,x=lon,y=lat,z=precip)
mylist <- list()
i=st[1]
for (i in seq_along(st)){
mylist[[i]]<-with(sub.list$`i`, interp(x = lon, y = lat, z = precip))
}
mylist[[i]]<-with(sub.list$`i`, interp(x = lon, y = lat, z = precip))
mylist[[1]]<-with(sub.list$`600`, interp(x = lon, y = lat, z = precip))
?interp
lapply(X = sub.list,FUN = with(X,interp,x=lon,y=lat,z=precip))
lapply(X = sub.list,FUN = with(sub.list,interp,x=lon,y=lat,z=precip))
mylist <- list()
i=st[1]
for (i in seq_along(st)){
mylist[[i]]<-with(sub.list$`i`, interp(x = lon, y = lat, z = precip))
}
i=st[1]
for (i in i:st)){
mylist[[i]]<-with(sub.list$`i`, interp(x = lon, y = lat, z = precip))
}
for (i in i:st)){
mylist[[i]]<-with(sub.list$`i`, interp(x = lon, y = lat, z = precip))
}
for (i in i:st){
mylist[[i]]<-with(sub.list$`i`, interp(x = lon, y = lat, z = precip))
}
i=st[1]
for (i in st){
mylist[[i]]<-with(sub.list$`i`, interp(x = lon, y = lat, z = precip))
}
i=st[1]
for (i in i:st){
mylist[[i]]<-with(sub.list$`i`, interp(x = lon, y = lat, z = precip))
}
length(sub.list)
i=1
for (i in length(sub.list){
mylist[[i]]<-with(sub.list$`i`, interp(x = lon, y = lat, z = precip))
}
for (i in length(sub.list)){
mylist[[i]]<-with(sub.list$`i`, interp(x = lon, y = lat, z = precip))
}
for (i in length(sub.list)){
mylist[i]<-with(sub.list$`i`, interp(x = lon, y = lat, z = precip))
}
i=1
for (i in i:length(sub.list)){
mylist[[i]]<-with(sub.list$`i`, interp(x = lon, y = lat, z = precip))
}
i=1
for (i in length(sub.list)){
mylist[[i]]<-with(sub.list$`i`, interp(x = lon, y = lat, z = precip))
}
for (i in length(sub.list)){
results[[i]]<-with(sub.list$`i`, interp(x = lon, y = lat, z = precip))
}
results <-list() # create and empty list for results
results[[i]]<-with(store$`i`, interp(x = lon, y = lat, z = precip)).
results <-list() # create and empty list for results
results[[i]]<-with(store$`i`, interp(x = lon, y = lat, z = precip))
results <-list() # create and empty list for results
results[[i]]<-with(sub.list$`i`, interp(x = lon, y = lat, z = precip))
results <-list() # create and empty list for results
results[[i]]<-with(sub.list$`i`, interp(x = lon, y = lat, z = precip))
i=600
results <-list() # create and empty list for results
results[[i]]<-with(sub.list$`i`, interp(x = lon, y = lat, z = precip))
results <-list() # create and empty list for results
results[[i]]<-with(sub.list$`600`, interp(x = lon, y = lat, z = precip))
results <- list()
results[[i]]<-with(sub.list$`600`, interp(x = lon, y = lat, z = precip))
results <- list()
results<-with(sub.list$`600`, interp(x = lon, y = lat, z = precip))
lapply(seq_along(sub.list),interp,x=lon,y=lat,z=precip)
lapply(seq_along(sub.list),with(interp,x=lon,y=lat,z=precip))
lapply(seq_along(sub.list),with(x,interp,x=lon,y=lat,z=precip))
interp
lapply(seq_along(sub.list),interp,x=[]lon,y=[]lat,z=[]precip)
sub.list[]
sub.list[[]]
sub.list[[]]$
sub.list[[1]]
sub.list[[1]]$
lapply(seq_along(sub.list),interp,x=[[]]lon,y=[[]]lat,z=[[]]precip)
lapply(seq_along(sub.list),interp,x=[[i]]lon,y=[[i]]lat,z=[[i]]precip)
lapply(seq_along(sub.list), function(x,y,z,i) {interp(x=[[i]]lon,y=[[i]]lat,z=[[i]]precip)}
lapply(seq_along(sub.list), function(x,y,z,i) {interp(x=[[i]]lon,y=[[i]]lat,z=[[i]]precip)}
lapply(seq_along(sub.list), function(x,y,z,i)
lapply(seq_along(sub.list), function(x,y,z,i)
{interp(x=[i]lon,y=[i]lat,z=[i]precip)})
lapply(seq_along(sub.list), function(x,y,z,i)
{interp(x=i$lon,y=i$lat,z=i$precip)})
lapply(seq_along(sub.list), function(i) paste(names(sub.list)[[i]], x[[i]]))
rm(i)
lapply(seq_along(sub.list), function(i) paste(names(sub.list)[[i]], x[[i]]))
lapply(seq_along(sub.list), function(i) paste(names(sub.list)[[i]]))
lapply(seq_along(sub.list), function(i) interp(names(sub.list)[[i]]))
lapply(seq_along(sub.list), function(i) interp(names(sub.list)[[i]]),x=lon,y=lat,z=precip)
lapply(seq_along(sub.list), function(i) interp(sub.list[[i]],x=lon,y=lat,z=precip)
)
lapply(seq_along(sub.list), function(i) interp([[i]],x=lon,y=lat,z=precip)
lapply(seq_along(sub.list), function(i) with(i,interp,x=lon,y=lat,z=precip)
)
lapply(seq_along(sub.list), function(i) interp(names(sub.list)[[i]]),x=lon,y=lat,z=precip)
lapply(seq_along(sub.list), function(i) interp(names(sub.list)[[i]]))
lapply(seq_along(sub.list), function(i) paste(names(sub.list)[[i]], x[[i]]))
lapply(seq_along(sub.list), function(i) paste(names(sub.list)[[i]], x[[i]]))
lapply(seq_along(sub.list), function(i) paste(names(sub.list)[[i]]))
lapply(seq_along(sub.list), function(i) with(sub.list)[[i]],interp,x=lon,y=lat,z=precip)
lapply(seq_along(sub.list), function(i) with(sub.list[[i]],interp,x=lon,y=lat,z=precip)
lapply(seq_along(sub.list), function(i) with(sub.list[[i]],interp,x=lon,y=lat,z=precip))
out<-lapply(seq_along(sub.list), function(i) with(sub.list[[i]],interp,x=lon,y=lat,z=precip))
out<-lapply(seq_along(sub.list), function(x,y,z,i) with(sub.list[[i]],interp,x=lon,y=lat,z=precip))
out<-lapply(seq_along(sub.list), function(i) with(sub.list[[i]],interp,x=lon,y=lat,z=precip))
out<-lapply(seq_along(sub.list), function(i) with(sub.list[[i]],interp),x=lon,y=lat,z=precip)
out<-lapply(seq_along(sub.list), function(i,x,y,z) with(sub.list[[i]],interp),x=lon,y=lat,z=precip)
out<-lapply(seq_along(sub.list), function(i) with(sub.list[[i]],interp,x=lon,y=lat,z=precip))
out<-lapply(seq_along(sub.list), function(i,x,y,z) with(sub.list[[i]],interp),x=lon,y=lat,z=precip)
out<-lapply(seq_along(sub.list), function(i,x,y,z) with(sub.list[[i]],interp,x=lon,y=lat,z=precip))
out<-lapply(seq_along(sub.list), function(i,x,y,z) with(sub.list[[i]],interp),x=lon,y=lat,z=precip)
out<-lapply(seq_along(sub.list), function(i,x,y,z) {with(sub.list[[i]],interp)},x=lon,y=lat,z=precip)
out<-lapply(seq_along(sub.list), function(x,y,z,i) {with(sub.list[[i]],interp)},x=lon,y=lat,z=precip)
sub.listt[[1]]
sub.list[[1]]
out<-lapply(seq_along(sub.list), function(i) with(sub.list[[i]],interp,x=lon,y=lat,z=precip))
out<-lapply(seq_along(sub.list), function(i) with(sub.list[[i]],interp(x=lon,y=lat,z=precip))
)
out<-lapply(seq_along(sub.list), function(i,x,y,z) with(sub.list[[i]],interp(x=lon,y=lat,z=precip))
)
out<-lapply(seq_along(sub.list), function(x,y,z,i) {with(sub.list[[i]],interp(x=lon,y=lat,z=precip))})
out<-lapply(seq_along(sub.list), function(i,x,y,z) with(sub.list[[i]],interp),x=lon,y=lat,z=precip)
out<-lapply(seq_along(sub.list), function(x,y,z,i) {with(sub.list[[i]],interp)},x=lon,y=lat,z=precip)
out<-lapply(seq_along(sub.list), function(i,x,y,z) with(sub.list[[i]],interp),x=lon,y=lat,z=precip)
out<-lapply(seq_along(sub.list), function(i,x,y,z) with(sub.list[[i]],interp(x=lon,y=lat,z=precip))
)
out<-lapply(seq_along(sub.list), function(i,x,y,z) with(sub.list[[i]],interp),x=lon,y=lat,z=precip)
i=1
for (i in i:length(sub.list)){
results[[i]]<-with(sub.list[[i]], interp(x = lon, y = lat, z = precip))
}
results$x
results[[1]]
results[[2]]
i=1
results <- list()
i=1
for (i in i:length(sub.list)){
results[[i]]<-with(sub.list[[i]], interp(x = lon, y = lat, z = precip))
}
results <- list()
i=125
for (i in i:length(sub.list)){
results[[i]]<-with(sub.list[[i]], interp(x = lon, y = lat, z = precip))
}
i=i
for (i in i:length(sub.list)){
results[[i]]<-with(sub.list[[i]], interp(x = lon, y = lat, z = precip))
}
i=i
i=i
for (i in i:length(sub.list)){
results[i]<-with(sub.list[[i]], interp(x = lon, y = lat, z = precip))
}
i=i
i=1
for (i in i:length(sub.list)){
results[[i]]<-with(sub.list[[i]], interp(x = lon, y = lat, z = precip))
}
i=1
for (i in i:length(sub.list)){
results[i]<-with(sub.list[[i]], interp(x = lon, y = lat, z = precip))
}
i=1
for (i in i:length(sub.list)){
results[[i]]<-with(sub.list[[i]], interp(x = lon, y = lat, z = precip))
}
results[[1]]
results <- list()
sub.df <- merged.df %>% filter(.,frameID>=600)
sub.list <- split(sub.df,sub.df$frameID)
View(sub.df)
length(sub.list)
results[[i]]<-with(store$[[1]], interp(x = lon, y = lat, z = precip)).
results[[i]]<-with(store[[1]], interp(x = lon, y = lat, z = precip)).
results[[i]]<-with(store[[1]], interp(x = lon, y = lat, z = precip))
results[[i]]<-with(sub.list[[1]], interp(x = lon, y = lat, z = precip))
sub.list[[1]]
results[[1]]<-with(sub.list[[1]], interp(x = lon, y = lat, z = precip))
i=1
results <- list()
for (i in i:length(sub.list)){
results[[i]]<-with(sub.list[[i]], interp(x = lon, y = lat, z = precip))
}
sub.df <- merged.df %>% filter(.,frameID>=800)
sub.list <- split(sub.df,sub.df$frameID)
results <- list()
i=1
for (i in i:length(sub.list)){
results[[i]]<-with(sub.list[[i]], interp(x = lon, y = lat, z = precip))
}
sub.list$`870`
plot(sub.list$`870`)
plot(sub.list$`870`)
plot(sub.list$`870`$precip)
plot(sub.list$`870`$precip,sub.list`871`$precip)
plot(sub.list$`870`$precip,sub.list$`871`$precip)
plot(sub.list$`869`$precip,sub.list$`870`$precip)
sub.df <- merged.df %>% filter(.,frameID>=800)
sub.list <- split(sub.df,sub.df$frameID)
results <- list()
i=1
for (i in i:length(sub.list)){
results[[i]]<-with(sub.list[[i]], interp(x = lon, y = lat, z = precip))
}
plot(sub.list$`869`$lon,sub.list$`870`$lat)
plot(sub.list$`869`$lon,sub.list$`869`$lat)
plot(sub.list$`870`$lon,sub.list$`870`$lat)
plot(sub.list$`869`$lon,sub.list$`869`$lat)
plot(sub.list$`868`$lon,sub.list$`868`$lat)
plot(sub.list$`870`$lon,sub.list$`870`$lat)
results <- list()
i=1
for (i in i:length(sub.list)){
results[[i]]<-with(sub.list[[i]], interp(x = lon, y = lat, z = precip,duplicate = mean))
}
i=1
for (i in i:length(sub.list)){
results[[i]]<-with(sub.list[[i]], interp(x = lon, y = lat, z = precip,duplicate = "mean"))
}
plot(sub.list$`870`$precip,sub.list$`871`$precip)
plot(sub.list$`871`$precip,sub.list$`872`$precip)
plot(sub.list$`874`$precip,sub.list$`875`$precip)
sub.df <- merged.df %>% filter(.,frameID>=600)
sub.list <- split(sub.df,sub.df$frameID)
results <- list()
i=1
for (i in i:length(sub.list)){
results[[i]]<-with(sub.list[[i]], interp(x = lon, y = lat, z = precip,duplicate = "mean"))
}
filled.contour(x = results[[1]]x,
y = results[[1]]y,
z = results[[1]]z,
color.palette =
colorRampPalette(c("white", "blue")),
xlab = "Longitude",
ylab = "Latitude",
main = "Germany Rainfall January 1894",
key.title = title(main = "Rain (mm)", cex.main = 1))
filled.contour(x = results[[1]]$x,
y = results[[1]]$y,
z = results[[1]]$z,
color.palette =
colorRampPalette(c("white", "blue")),
xlab = "Longitude",
ylab = "Latitude",
main = "Germany Rainfall January 1894",
key.title = title(main = "Rain (mm)", cex.main = 1))
filled.contour(x = results[[2]]$x,
y = results[[2]]$y,
z = results[[2]]$z,
color.palette =
colorRampPalette(c("white", "blue")),
xlab = "Longitude",
ylab = "Latitude",
main = "Germany Rainfall January 1894",
key.title = title(main = "Rain (mm)", cex.main = 1))
filled.contour(x = results[[2]]$x,
y = results[[2]]$y,
z = results[[2]]$z,
color.palette =
colorRampPalette(c("white", "blue")),
xlab = "Longitude",
ylab = "Latitude",
main = "Germany Rainfall January 1894",
key.title = title(main = "Rain (mm)", cex.main = 1))
filled.contour(x = sta$x,
y = sta$y,
z = sta$z,
color.palette =
colorRampPalette(c("white", "blue")),
xlab = "Longitude",
ylab = "Latitude",
main = "Germany Rainfall January 1894",
key.title = title(main = "Rain (mm)", cex.main = 1))
par(mfrow=c(1,1))
filled.contour(x = sta$x,
y = sta$y,
z = sta$z,
color.palette =
colorRampPalette(c("white", "blue")),
xlab = "Longitude",
ylab = "Latitude",
main = "Germany Rainfall January 1894",
key.title = title(main = "Rain (mm)", cex.main = 1))
